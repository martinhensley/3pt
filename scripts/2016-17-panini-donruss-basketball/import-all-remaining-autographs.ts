import { PrismaClient } from '@prisma/client';
import { generateSetSlug, generateCardSlug } from '../../lib/slugGenerator';

const prisma = new PrismaClient();

// Using compact representation to fit all data
type C = [string, string, string, number | null]; // [number, player, team, printRun]

const calcRarity = (pr: number | null) => !pr ? null : pr === 1 ? 'one_of_one' : pr <= 10 ? 'ultra_rare' : pr <= 50 ? 'super_rare' : pr <= 199 ? 'rare' : 'base';
const fmtNum = (pr: number | null) => !pr ? null : pr === 1 ? '1 of 1' : `/${pr}`;

interface S { n: string; c: C[]; p?: boolean; b?: string; m?: boolean }

const sets: S[] = [
  // Elite Signatures + parallels (96 cards each = 288 total)
  { n: 'Elite Signatures', c: [
    ['1','Kevin Durant','Golden State Warriors',99],['2','C.J. Miles','Indiana Pacers',25],['3','T.J. McConnell','Philadelphia 76ers',99],['4','Allen Crabbe','Portland Trail Blazers',25],['5','Marcelo Huertas','Los Angeles Lakers',99],['6','Deron Williams','Dallas Mavericks',25],['7','Jordan McRae','Cleveland Cavaliers',99],['8','Dennis Schroder','Atlanta Hawks',25],['9','Carmelo Anthony','New York Knicks',25],['10','Alan Anderson','Los Angeles Clippers',25],['11','Kyrie Irving','Cleveland Cavaliers',99],['12','Aaron Harrison','Charlotte Hornets',99],['13','Mike Muscala','Atlanta Hawks',25],['14','Karl-Anthony Towns','Minnesota Timberwolves',25],['15','Dirk Nowitzki','Dallas Mavericks',49],['16','Bob Dandridge','Milwaukee Bucks',49],['17','Walter Tavares','Atlanta Hawks',49],['18','Draymond Green','Golden State Warriors',25],['19','Vin Baker','Seattle Supersonics',49],['20','Seth Curry','Dallas Mavericks',25],['21','Mark Price','Cleveland Cavaliers',49],['22','Luis Montero','Portland Trail Blazers',99],['23','Dan Majerle','Phoenix Suns',25],['24','D\'Angelo Russell','Los Angeles Lakers',25],['25','Jim Jackson','Phoenix Suns',25],['26','E\'Twaun Moore','New Orleans Pelicans',49],['27','Langston Galloway','New Orleans Pelicans',25],['28','Glen Rice','Miami Heat',25],['29','C.J. Wilcox','Orlando Magic',49],['30','Jamal Mashburn','Charlotte Hornets',25],['31','Rashad Vaughn','Milwaukee Bucks',25],['32','Dennis Scott','Orlando Magic',25],['33','Noah Vonleh','Portland Trail Blazers',99],['34','Dell Curry','Charlotte Hornets',25],['35','Kelly Olynyk','Boston Celtics',25],['36','Vinny Del Negro','San Antonio Spurs',25],['37','Anthony Bennett','Brooklyn Nets',99],['38','Glenn Robinson III','Indiana Pacers',25],['39','Bill Laimbeer','Detroit Pistons',25],['40','Dikembe Mutombo','Houston Rockets',25],['41','James Ennis','Memphis Grizzlies',99],['42','Jeff Hornacek','Phoenix Suns',25],['43','Robert Covington','Philadelphia 76ers',25],['45','Jalen Rose','Chicago Bulls',25],['46','C.J. McCollum','Portland Trail Blazers',49],['47','Tim Hardaway','Golden State Warriors',25],['48','Michael Kidd-Gilchrist','Charlotte Hornets',99],['49','Latrell Sprewell','New York Knicks',25],['50','Dwight Powell','Dallas Mavericks',99],['51','Bobby Portis','Chicago Bulls',25],['52','Raef LaFrentz','Denver Nuggets',25],['53','Jonas Valanciunas','Toronto Raptors',25],['54','Larry Nance','Cleveland Cavaliers',25],['55','Cody Zeller','Charlotte Hornets',99],['56','Festus Ezeli','Portland Trail Blazers',25],['57','Jo Jo White','Golden State Warriors',25],['58','JaKarr Sampson','Denver Nuggets',99],['59','P.J. Tucker','Phoenix Suns',25],['60','Chauncey Billups','Detroit Pistons',25],['62','Mark Aguirre','Dallas Mavericks',25],['63','Avery Johnson','San Antonio Spurs',25],['64','Reggie Bullock','Detroit Pistons',99],['65','Marcus Camby','New York Knicks',25],['66','Antonio McDyess','Denver Nuggets',25],['67','Steve Novak','Milwaukee Bucks',49],['68','Dee Brown','Boston Celtics',25],['69','Michael Carter-Williams','Milwaukee Bucks',49],['70','Bryon Russell','Utah Jazz',25],['71','Kevon Looney','Golden State Warriors',49],['72','Rolando Blackman','Dallas Mavericks',25],['73','Steve Smith','Atlanta Hawks',25],['74','Jeff Withey','Utah Jazz',49],['75','Scott Skiles','Orlando Magic',25],['76','Tyronn Lue','Los Angeles Lakers',25],['77','Ian Clark','Golden State Warriors',99],['78','Jerry Stackhouse','Detroit Pistons',25],['79','Devin Harris','Dallas Mavericks',25],['80','Mark Jackson','New York Knicks',25],['81','Tristan Thompson','Cleveland Cavaliers',49],['82','Mike Bibby','Sacramento Kings',25],['83','Matthew Dellavedova','Milwaukee Bucks',49],['84','B.J. Armstrong','Chicago Bulls',25],['85','Kyle O\'Quinn','New York Knicks',99],['86','Rick Fox','Los Angeles Lakers',25],['87','Clifford Robinson','Portland Trail Blazers',25],['88','Lamar Patterson','Sacramento Kings',99],['89','Terry Porter','Portland Trail Blazers',25],['90','Kenny Anderson','New Jersey Nets',25],['92','Tom Gugliotta','Minnesota Timberwolves',25],['93','Tony Delk','Boston Celtics',25],['94','Alex Len','Phoenix Suns',99],['95','Kendall Gill','Charlotte Hornets',25],['97','Sam Bowie','Portland Trail Blazers',25],['98','Troy Daniels','Memphis Grizzlies',99],['99','Juwan Howard','Miami Heat',25],['100','Josh Huestis','Oklahoma City Thunder',99]
  ] },
  { n: 'Elite Signatures Black', p: true, b: 'Elite Signatures', c: [
    ['1','Kevin Durant','Golden State Warriors',1],['2','C.J. Miles','Indiana Pacers',1],['3','T.J. McConnell','Philadelphia 76ers',1],['4','Allen Crabbe','Portland Trail Blazers',1],['5','Marcelo Huertas','Los Angeles Lakers',1],['6','Deron Williams','Dallas Mavericks',1],['7','Jordan McRae','Cleveland Cavaliers',1],['8','Dennis Schroder','Atlanta Hawks',1],['9','Carmelo Anthony','New York Knicks',1],['10','Alan Anderson','Los Angeles Clippers',1],['11','Kyrie Irving','Cleveland Cavaliers',1],['12','Aaron Harrison','Charlotte Hornets',1],['13','Mike Muscala','Atlanta Hawks',1],['14','Karl-Anthony Towns','Minnesota Timberwolves',1],['15','Dirk Nowitzki','Dallas Mavericks',1],['16','Bob Dandridge','Milwaukee Bucks',1],['17','Walter Tavares','Atlanta Hawks',1],['18','Draymond Green','Golden State Warriors',1],['19','Vin Baker','Seattle Supersonics',1],['20','Seth Curry','Dallas Mavericks',1],['21','Mark Price','Cleveland Cavaliers',1],['22','Luis Montero','Portland Trail Blazers',1],['23','Dan Majerle','Phoenix Suns',1],['24','D\'Angelo Russell','Los Angeles Lakers',1],['25','Jim Jackson','Phoenix Suns',1],['26','E\'Twaun Moore','New Orleans Pelicans',1],['27','Langston Galloway','New Orleans Pelicans',1],['28','Glen Rice','Miami Heat',1],['29','C.J. Wilcox','Orlando Magic',1],['30','Jamal Mashburn','Charlotte Hornets',1],['31','Rashad Vaughn','Milwaukee Bucks',1],['32','Dennis Scott','Orlando Magic',1],['33','Noah Vonleh','Portland Trail Blazers',1],['34','Dell Curry','Charlotte Hornets',1],['35','Kelly Olynyk','Boston Celtics',1],['36','Vinny Del Negro','San Antonio Spurs',1],['37','Anthony Bennett','Brooklyn Nets',1],['38','Glenn Robinson III','Indiana Pacers',1],['39','Bill Laimbeer','Detroit Pistons',1],['40','Dikembe Mutombo','Houston Rockets',1],['41','James Ennis','Memphis Grizzlies',1],['42','Jeff Hornacek','Phoenix Suns',1],['43','Robert Covington','Philadelphia 76ers',1],['45','Jalen Rose','Chicago Bulls',1],['46','C.J. McCollum','Portland Trail Blazers',1],['47','Tim Hardaway','Golden State Warriors',1],['48','Michael Kidd-Gilchrist','Charlotte Hornets',1],['49','Latrell Sprewell','New York Knicks',1],['50','Dwight Powell','Dallas Mavericks',1],['51','Bobby Portis','Chicago Bulls',1],['52','Raef LaFrentz','Denver Nuggets',1],['53','Jonas Valanciunas','Toronto Raptors',1],['54','Larry Nance','Cleveland Cavaliers',1],['55','Cody Zeller','Charlotte Hornets',1],['56','Festus Ezeli','Portland Trail Blazers',1],['57','Jo Jo White','Golden State Warriors',1],['58','JaKarr Sampson','Denver Nuggets',1],['59','P.J. Tucker','Phoenix Suns',1],['60','Chauncey Billups','Detroit Pistons',1],['62','Mark Aguirre','Dallas Mavericks',1],['63','Avery Johnson','San Antonio Spurs',1],['64','Reggie Bullock','Detroit Pistons',1],['65','Marcus Camby','New York Knicks',1],['66','Antonio McDyess','Denver Nuggets',1],['67','Steve Novak','Milwaukee Bucks',1],['68','Dee Brown','Boston Celtics',1],['69','Michael Carter-Williams','Milwaukee Bucks',1],['70','Bryon Russell','Utah Jazz',1],['71','Kevon Looney','Golden State Warriors',1],['72','Rolando Blackman','Dallas Mavericks',1],['73','Steve Smith','Atlanta Hawks',1],['74','Jeff Withey','Utah Jazz',1],['75','Scott Skiles','Orlando Magic',1],['76','Tyronn Lue','Los Angeles Lakers',1],['77','Ian Clark','Golden State Warriors',1],['78','Jerry Stackhouse','Detroit Pistons',1],['79','Devin Harris','Dallas Mavericks',1],['80','Mark Jackson','New York Knicks',1],['81','Tristan Thompson','Cleveland Cavaliers',1],['82','Mike Bibby','Sacramento Kings',1],['83','Matthew Dellavedova','Milwaukee Bucks',1],['84','B.J. Armstrong','Chicago Bulls',1],['85','Kyle O\'Quinn','New York Knicks',1],['86','Rick Fox','Los Angeles Lakers',1],['87','Clifford Robinson','Portland Trail Blazers',1],['88','Lamar Patterson','Sacramento Kings',1],['89','Terry Porter','Portland Trail Blazers',1],['90','Kenny Anderson','New Jersey Nets',1],['92','Tom Gugliotta','Minnesota Timberwolves',1],['93','Tony Delk','Boston Celtics',1],['94','Alex Len','Phoenix Suns',1],['95','Kendall Gill','Charlotte Hornets',1],['97','Sam Bowie','Portland Trail Blazers',1],['98','Troy Daniels','Memphis Grizzlies',1],['99','Juwan Howard','Miami Heat',1],['100','Josh Huestis','Oklahoma City Thunder',1]
  ] },
  { n: 'Elite Signatures Green', p: true, b: 'Elite Signatures', c: [
    ['1','Kevin Durant','Golden State Warriors',5],['2','C.J. Miles','Indiana Pacers',5],['3','T.J. McConnell','Philadelphia 76ers',5],['4','Allen Crabbe','Portland Trail Blazers',5],['5','Marcelo Huertas','Los Angeles Lakers',5],['6','Deron Williams','Dallas Mavericks',5],['7','Jordan McRae','Cleveland Cavaliers',5],['8','Dennis Schroder','Atlanta Hawks',5],['9','Carmelo Anthony','New York Knicks',5],['10','Alan Anderson','Los Angeles Clippers',5],['11','Kyrie Irving','Cleveland Cavaliers',5],['12','Aaron Harrison','Charlotte Hornets',5],['13','Mike Muscala','Atlanta Hawks',5],['14','Karl-Anthony Towns','Minnesota Timberwolves',5],['15','Dirk Nowitzki','Dallas Mavericks',5],['16','Bob Dandridge','Milwaukee Bucks',5],['17','Walter Tavares','Atlanta Hawks',5],['18','Draymond Green','Golden State Warriors',5],['19','Vin Baker','Seattle Supersonics',5],['20','Seth Curry','Dallas Mavericks',5],['21','Mark Price','Cleveland Cavaliers',5],['22','Luis Montero','Portland Trail Blazers',5],['23','Dan Majerle','Phoenix Suns',5],['24','D\'Angelo Russell','Los Angeles Lakers',5],['25','Jim Jackson','Phoenix Suns',5],['26','E\'Twaun Moore','New Orleans Pelicans',5],['27','Langston Galloway','New Orleans Pelicans',5],['28','Glen Rice','Miami Heat',5],['29','C.J. Wilcox','Orlando Magic',5],['30','Jamal Mashburn','Charlotte Hornets',5],['31','Rashad Vaughn','Milwaukee Bucks',5],['32','Dennis Scott','Orlando Magic',5],['33','Noah Vonleh','Portland Trail Blazers',5],['34','Dell Curry','Charlotte Hornets',5],['35','Kelly Olynyk','Boston Celtics',5],['36','Vinny Del Negro','San Antonio Spurs',5],['37','Anthony Bennett','Brooklyn Nets',5],['38','Glenn Robinson III','Indiana Pacers',5],['39','Bill Laimbeer','Detroit Pistons',5],['40','Dikembe Mutombo','Houston Rockets',5],['41','James Ennis','Memphis Grizzlies',5],['42','Jeff Hornacek','Phoenix Suns',5],['43','Robert Covington','Philadelphia 76ers',5],['45','Jalen Rose','Chicago Bulls',5],['46','C.J. McCollum','Portland Trail Blazers',5],['47','Tim Hardaway','Golden State Warriors',5],['48','Michael Kidd-Gilchrist','Charlotte Hornets',5],['49','Latrell Sprewell','New York Knicks',5],['50','Dwight Powell','Dallas Mavericks',5],['51','Bobby Portis','Chicago Bulls',5],['52','Raef LaFrentz','Denver Nuggets',5],['53','Jonas Valanciunas','Toronto Raptors',5],['54','Larry Nance','Cleveland Cavaliers',5],['55','Cody Zeller','Charlotte Hornets',5],['56','Festus Ezeli','Portland Trail Blazers',5],['57','Jo Jo White','Golden State Warriors',5],['58','JaKarr Sampson','Denver Nuggets',5],['59','P.J. Tucker','Phoenix Suns',5],['60','Chauncey Billups','Detroit Pistons',5],['62','Mark Aguirre','Dallas Mavericks',5],['63','Avery Johnson','San Antonio Spurs',5],['64','Reggie Bullock','Detroit Pistons',5],['65','Marcus Camby','New York Knicks',5],['66','Antonio McDyess','Denver Nuggets',5],['67','Steve Novak','Milwaukee Bucks',5],['68','Dee Brown','Boston Celtics',5],['69','Michael Carter-Williams','Milwaukee Bucks',5],['70','Bryon Russell','Utah Jazz',5],['71','Kevon Looney','Golden State Warriors',5],['72','Rolando Blackman','Dallas Mavericks',5],['73','Steve Smith','Atlanta Hawks',5],['74','Jeff Withey','Utah Jazz',5],['75','Scott Skiles','Orlando Magic',5],['76','Tyronn Lue','Los Angeles Lakers',5],['77','Ian Clark','Golden State Warriors',5],['78','Jerry Stackhouse','Detroit Pistons',5],['79','Devin Harris','Dallas Mavericks',5],['80','Mark Jackson','New York Knicks',5],['81','Tristan Thompson','Cleveland Cavaliers',5],['82','Mike Bibby','Sacramento Kings',5],['83','Matthew Dellavedova','Milwaukee Bucks',5],['84','B.J. Armstrong','Chicago Bulls',5],['85','Kyle O\'Quinn','New York Knicks',5],['86','Rick Fox','Los Angeles Lakers',5],['87','Clifford Robinson','Portland Trail Blazers',5],['88','Lamar Patterson','Sacramento Kings',5],['89','Terry Porter','Portland Trail Blazers',5],['90','Kenny Anderson','New Jersey Nets',5],['92','Tom Gugliotta','Minnesota Timberwolves',5],['93','Tony Delk','Boston Celtics',5],['94','Alex Len','Phoenix Suns',5],['95','Kendall Gill','Charlotte Hornets',5],['97','Sam Bowie','Portland Trail Blazers',5],['98','Troy Daniels','Memphis Grizzlies',5],['99','Juwan Howard','Miami Heat',5],['100','Josh Huestis','Oklahoma City Thunder',5]
  ] },
];

async function main() {
  console.log('Importing remaining autograph sets...\n');

  const release = await prisma.release.findUnique({ where: { slug: '2016-17-panini-donruss-basketball' } });
  if (!release) throw new Error('Release not found');

  const setSlugMap = new Map<string, string>();
  let totalSets = 0, totalCards = 0;

  for (const s of sets) {
    console.log(`Processing: ${s.n} (${s.c.length} cards)...`);
    
    const setSlug = generateSetSlug('2016-17', 'Donruss Basketball', s.n, 'Autograph', s.p ? 'parallel' : undefined);
    setSlugMap.set(s.n, setSlug);
    
    const existing = await prisma.set.findUnique({ where: { slug: setSlug } });
    if (existing) { console.log(`  ⚠️  Already exists\n`); continue; }
    
    const set = await prisma.set.create({
      data: {
        slug: setSlug, name: s.n, type: 'Autograph', releaseId: release.id,
        isParallel: s.p || false, baseSetSlug: s.b ? setSlugMap.get(s.b) || null : null
      }
    });
    
    totalSets++;
    let created = 0;
    
    for (const [num, player, team, pr] of s.c) {
      const variant = s.n.includes('Black') ? 'Black' : s.n.includes('Gold') ? 'Gold' : s.n.includes('Green') ? 'Green' : null;
      const slug = generateCardSlug('Panini', 'Donruss Basketball', '2016-17', s.n, num, player, variant, pr, 'Autograph');
      
      await prisma.card.create({
        data: {
          slug, playerName: player, team, cardNumber: num, setId: set.id, variant,
          printRun: pr, isNumbered: pr !== null, numbered: fmtNum(pr), rarity: calcRarity(pr),
          hasAutograph: true, hasMemorabilia: s.m || false
        }
      });
      created++;
    }
    
    totalCards += created;
    console.log(`  ✓ Created ${created} cards\n`);
  }

  console.log(`\n✅ Complete! Sets: ${totalSets}, Cards: ${totalCards}`);
}

main().catch(e => { console.error(e); process.exit(1); }).finally(() => prisma.$disconnect());
