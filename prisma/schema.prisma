// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Note: This User model is no longer used for authentication.
// Authentication is handled by neon_auth.admin_users table.
// This model is kept for potential future use or historical data.
model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Manufacturer {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  releases  Release[]
}

model Release {
  id             String       @id @default(cuid())
  name           String
  year           String?
  manufacturerId String
  manufacturer   Manufacturer @relation(fields: [manufacturerId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  sets           Set[]
  posts          Post[]
}

model Set {
  id          String   @id @default(cuid())
  name        String
  releaseId   String
  release     Release  @relation(fields: [releaseId], references: [id])
  totalCards  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  cards       Card[]
  posts       Post[]
}

model Card {
  id                    String   @id @default(cuid())
  playerName            String?
  team                  String?
  cardNumber            String?
  variant               String?  // Basic variant name (e.g., "Refractor", "Chrome")

  // Enhanced parallel/variation detection fields
  parallelType          String?  // Specific parallel type (e.g., "Gold Refractor", "Red Wave")
  serialNumber          String?  // Serial number if numbered (e.g., "123/299")
  isNumbered            Boolean  @default(false)
  printRun              Int?     // Total print run (e.g., 299 for /299)
  rarity                String?  // Rarity level (base, rare, super_rare, ultra_rare, one_of_one)
  finish                String?  // Card finish (refractor, chrome, matte, glossy, holographic)
  hasAutograph          Boolean  @default(false)
  hasMemorabilia        Boolean  @default(false)
  specialFeatures       String[] // Array of special features (rookie, insert, short_print, etc.)
  colorVariant          String?  // Color designation (gold, red, blue, green, orange, etc.)

  // OCR and detection metadata
  detectionConfidence   Int?     // AI confidence score (0-100)
  detectionMethods      String[] // Methods used (ocr, visual, ai_analysis)
  detectedText          String?  // Raw OCR text for reference

  // Images
  imageFront            String?  // Front image URL
  imageBack             String?  // Back image URL

  setId                 String
  set                   Set      @relation(fields: [setId], references: [id])
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  posts                 Post[]
}

model Post {
  id          String      @id @default(cuid())
  title       String
  slug        String      @unique
  content     String
  excerpt     String?
  type        PostType
  published   Boolean     @default(false)
  releaseId   String?
  release     Release?    @relation(fields: [releaseId], references: [id])
  setId       String?
  set         Set?        @relation(fields: [setId], references: [id])
  cardId      String?
  card        Card?       @relation(fields: [cardId], references: [id])
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  authorId    String      // References neon_auth.admin_users.id (not enforced by FK)
  images      PostImage[]
}

model PostImage {
  id        String   @id @default(cuid())
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  url       String
  caption   String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
}

enum PostType {
  CARD
  SET
  RELEASE
  GENERAL
}
